"use strict";(()=>{var e={};e.id=660,e.ids=[660],e.modules={92509:e=>{e.exports=require("firebase-admin")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},79637:e=>{e.exports=import("firebase-admin/auth")},72929:e=>{e.exports=import("firebase-admin/firestore")},11698:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>d,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var s=r(49303),n=r(88716),i=r(60670),o=r(67242),p=e([o]);o=(p.then?(await p)():p)[0];let u=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin-log/route",pathname:"/api/admin-log",filename:"route",bundlePath:"app/api/admin-log/route"},resolvedPagePath:"/Users/amanchandra/Documents/Projects/Unified 1.1/src/app/api/admin-log/route.js",nextConfigOutput:"",userland:o}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:m}=u,h="/api/admin-log/route";function d(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}a()}catch(e){a(e)}})},49303:(e,t,r)=>{e.exports=r(30517)},67242:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{GET:()=>d});var s=r(79637),n=r(92509),i=r.n(n),o=r(72929),p=e([s,o]);if([s,o]=p.then?(await p)():p,!i().apps.length){let e=JSON.parse(process.env.FIREBASE_SERVICE_KEY);i().initializeApp({credential:i().credential.cert(e)})}let u=(0,o.getFirestore)();async function d(e){let t=e.headers.get("authorization"),r=t?.replace("Bearer ","");if(!r)return console.log("No token provided"),new Response(JSON.stringify({error:"Unauthorized"}),{status:401});try{if(!(await (0,s.getAuth)().verifyIdToken(r)).admin)return console.log("User is not an admin"),new Response(JSON.stringify({error:"Forbidden"}),{status:403});let e=await u.collection("updates").orderBy("createdAt","desc").get(),t=[];return e.forEach(e=>{let r=e.data(),a=e.id;t.push({id:a,timestamp:r.createdAt?.toDate?.()||new Date(r.createdAt),action:"CREATE",user:r.addedBy,message:r.message||r.eventName||r.department||"-",snapshot:JSON.stringify(r,null,2)}),r.history&&Array.isArray(r.history)&&r.history.forEach(e=>{t.push({id:a,timestamp:new Date(e.changedAt),action:"EDIT",user:e.changedBy,message:e.snapshot?.message||e.snapshot?.eventName||e.snapshot?.department||"-",snapshot:JSON.stringify(e.snapshot,null,2)})})}),new Response(JSON.stringify(t))}catch(e){return console.error("Error verifying token:",e),new Response(JSON.stringify([]),{status:401})}}a()}catch(e){a(e)}})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[948],()=>r(11698));module.exports=a})();